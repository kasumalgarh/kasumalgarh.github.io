<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>Royal Page Builder - KASUMALGARH</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ----------------------------- */
        /* ‚ú® ROYAL DARK THEME */
        /* ----------------------------- */
        :root {
            --bg-dark: #050510;
            --gold-primary: #d4af37;
            --gold-gradient: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7);
            --text-light: #e0e0e0;
            --panel-bg: #1a1a2e;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Lato', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* TOP BAR */
        .navbar {
            height: 60px;
            background: #111;
            border-bottom: 2px solid var(--gold-primary);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px;
            flex-shrink: 0;
        }
        .brand { font-family: 'Cinzel', serif; font-size: 1.2em; color: var(--gold-primary); font-weight: bold; }
        .action-btn {
            background: var(--gold-gradient); border: none; padding: 8px 20px;
            color: #2c0e0e; font-weight: bold; cursor: pointer; border-radius: 4px;
            font-family: 'Cinzel', serif;
        }
        .action-btn:hover { filter: brightness(1.1); }

        /* MAIN LAYOUT */
        .builder-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* 1. LEFT: TOOLS PANEL */
        .tools-panel {
            width: 350px;
            background: var(--panel-bg);
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 20px;
            display: flex; flex-direction: column; gap: 15px;
        }

        .tool-category { margin-bottom: 10px; }
        .cat-title { color: #888; font-size: 0.8em; text-transform: uppercase; margin-bottom: 8px; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 5px; }

        .tool-btn {
            display: flex; align-items: center; gap: 10px;
            width: 100%; padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #ddd; text-align: left;
            cursor: pointer; border-radius: 6px;
            transition: 0.2s; margin-bottom: 8px;
        }
        .tool-btn:hover { background: rgba(212, 175, 55, 0.2); border-color: var(--gold-primary); color: #fff; }
        .tool-btn i { color: var(--gold-primary); width: 20px; text-align: center; }

        /* 2. MIDDLE: LIVE PREVIEW */
        .preview-area {
            flex: 1;
            background: #e0e0e0;
            padding: 20px;
            overflow-y: auto;
            display: flex; justify-content: center;
        }

        #phone-frame {
            width: 100%; max-width: 1000px;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            min-height: 100%;
            border: 1px solid #ccc;
        }

        /* 3. RIGHT: SETTINGS PANEL (Hidden by default) */
        .settings-panel {
            width: 300px;
            background: #222;
            border-left: 1px solid #333;
            padding: 20px;
            display: none; /* Show when element clicked */
        }

        /* FORM ELEMENTS */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; color: #aaa; margin-bottom: 5px; font-size: 0.9em; }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; padding: 8px;
            background: #111; border: 1px solid #444;
            color: #fff; border-radius: 4px; box-sizing: border-box;
        }
        .input-group input:focus { border-color: var(--gold-primary); outline: none; }

        /* MODAL FOR PAGE DETAILS */
        #publishModal {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            justify-content: center; align-items: center;
        }
        .modal-box { background: #222; padding: 30px; border-radius: 10px; border: 2px solid var(--gold-primary); width: 400px; }

        /* --- PREVIEW STYLES (To Match Website) --- */
        /* ‡§Ø‡•á ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡•ç‡§∏ iframe ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡•Ä ‡§ú‡§æ‡§è‡§Ç‡§ó‡•Ä, ‡§Ø‡§π‡§æ‡§Å ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§∞‡•á‡§´‡§∞‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡§Ç */
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand"><i class="fas fa-magic"></i> PAGE BUILDER</div>
        <div style="display:flex; gap:10px;">
            <button onclick="clearCanvas()" style="background:#444; color:#fff; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">Reset</button>
            <button onclick="openPublishModal()" class="action-btn"><i class="fas fa-cloud-upload-alt"></i> PUBLISH PAGE</button>
        </div>
    </nav>

    <div class="builder-container">
        
        <div class="tools-panel">
            
            <div class="cat-title">STRUCTURE</div>
            <button class="tool-btn" onclick="addComponent('heading')"><i class="fas fa-heading"></i> Royal Heading (H1/H2)</button>
            <button class="tool-btn" onclick="addComponent('paragraph')"><i class="fas fa-paragraph"></i> Text Paragraph</button>
            <button class="tool-btn" onclick="addComponent('divider')"><i class="fas fa-grip-lines"></i> Gold Divider (‚öúÔ∏è)</button>

            <div class="cat-title">MEDIA & IMAGES</div>
            <button class="tool-btn" onclick="addComponent('image')"><i class="fas fa-image"></i> Image Upload</button>
            <button class="tool-btn" onclick="addComponent('video')"><i class="fab fa-youtube"></i> YouTube Video</button>

            <div class="cat-title">SPECIAL ELEMENTS</div>
            <button class="tool-btn" onclick="addComponent('jharokha')"><i class="fas fa-archway"></i> Jharokha Box (Card)</button>
            <button class="tool-btn" onclick="addComponent('button')"><i class="fas fa-mouse-pointer"></i> Action Button</button>
            <button class="tool-btn" onclick="addComponent('list')"><i class="fas fa-list-ul"></i> Bullet List</button>

        </div>

        <div class="preview-area">
            <iframe id="phone-frame"></iframe>
        </div>

    </div>

    <div id="publishModal">
        <div class="modal-box">
            <h3 style="color:var(--gold-primary); margin-top:0;">Final Details</h3>
            
            <div class="input-group">
                <label>File Name (e.g., events.html)</label>
                <input type="text" id="finalFileName" placeholder="page_name.html">
            </div>
            
            <div class="input-group">
                <label>Page Title (Browser Tab)</label>
                <input type="text" id="finalPageTitle" placeholder="My Royal Page">
            </div>

            <div class="input-group">
                <label>Page Header Title (Big Text)</label>
                <input type="text" id="finalHeaderTitle" placeholder="WELCOME">
            </div>

            <button onclick="publishToGitHub()" class="action-btn" style="width:100%;">CONFIRM & CREATE</button>
            <button onclick="document.getElementById('publishModal').style.display='none'" style="width:100%; background:none; border:none; color:#aaa; margin-top:10px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <script>
        // --- 1. INITIALIZE FRAME ---
        const frame = document.getElementById('phone-frame');
        const doc = frame.contentDocument || frame.contentWindow.document;

        // Base Template Styles (User's Website CSS)
        const baseStyles = `
            <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
            <style>
                :root { --royal-bg: #000033; --paper-bg: #fffbf0; --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); --maroon-text: #800000; --dark-gold-line: #aa8c2c; }
                body { margin: 0; background-color: var(--paper-bg); color: #333; font-family: 'Playfair Display', serif; padding: 20px; }
                
                /* Components */
                .royal-heading { font-family: 'Cinzel', serif; color: var(--maroon-text); border-bottom: 2px solid var(--dark-gold-line); display: inline-block; margin-top: 20px; }
                .royal-para { font-size: 1.1em; line-height: 1.6; color: #555; margin-bottom: 15px; }
                .gold-divider { text-align: center; font-size: 24px; color: #bf953f; margin: 20px 0; }
                
                .jharokha-box { 
                    border: 3px double var(--maroon-text); padding: 20px; margin: 20px 0; 
                    background: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.1); text-align: center; border-radius: 10px;
                }
                
                .royal-btn {
                    display: inline-block; padding: 10px 25px; 
                    background: linear-gradient(to right, #000033, #000066); 
                    color: #fcf6ba; text-decoration: none; font-family: 'Cinzel', serif; font-weight: bold;
                    border-radius: 50px; border: 1px solid var(--dark-gold-line);
                }

                img { max-width: 100%; border-radius: 5px; border: 2px solid var(--dark-gold-line); }
                
                /* Editor Helper */
                .editable-component { position: relative; border: 1px dashed transparent; cursor: pointer; }
                .editable-component:hover { border-color: blue; }
                .delete-btn { 
                    position: absolute; top: -10px; right: -10px; background: red; color: white; 
                    border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; display: none;
                }
                .editable-component:hover .delete-btn { display: block; }
            </style>
        `;

        // Initialize Canvas
        function initCanvas() {
            doc.open();
            doc.write(`<html><head>${baseStyles}</head><body id="canvas-body"><div id="content-area"></div></body></html>`);
            doc.close();
        }
        initCanvas();

        // --- 2. ADD COMPONENTS ---
        function addComponent(type) {
            const container = doc.getElementById('content-area');
            let html = '';

            switch(type) {
                case 'heading':
                    let text = prompt("Heading Text:", "New Royal Heading");
                    if(text) html = `<h2 class="royal-heading">${text}</h2>`;
                    break;
                case 'paragraph':
                    let pText = prompt("Paragraph Content:", "Enter your text here...");
                    if(pText) html = `<p class="royal-para">${pText}</p>`;
                    break;
                case 'divider':
                    html = `<div class="gold-divider">‚öúÔ∏è ‚öúÔ∏è ‚öúÔ∏è</div>`;
                    break;
                case 'image':
                    let imgUrl = prompt("Image URL (Paste Link):", "https://via.placeholder.com/600x400");
                    if(imgUrl) html = `<div style="text-align:center; margin:15px 0;"><img src="${imgUrl}" alt="Image"></div>`;
                    break;
                case 'video':
                    let vidId = prompt("YouTube Video ID (e.g., dQw4w9WgXcQ):");
                    if(vidId) html = `<div style="text-align:center; margin:20px 0;"><iframe width="100%" height="315" src="https://www.youtube.com/embed/${vidId}" frameborder="0" allowfullscreen></iframe></div>`;
                    break;
                case 'jharokha':
                    let jTitle = prompt("Box Title:", "Did You Know?");
                    let jContent = prompt("Box Content:", "Write something special...");
                    if(jTitle && jContent) html = `
                        <div class="jharokha-box">
                            <h3 style="color:#800000; font-family:'Cinzel', serif;">${jTitle}</h3>
                            <p>${jContent}</p>
                        </div>`;
                    break;
                case 'button':
                    let btnText = prompt("Button Text:", "Click Here");
                    let btnLink = prompt("Link URL:", "#");
                    if(btnText) html = `<div style="text-align:center; margin:15px 0;"><a href="${btnLink}" class="royal-btn">${btnText}</a></div>`;
                    break;
                case 'list':
                    html = `<ul class="royal-para" style="padding-left:20px;"><li>Item 1</li><li>Item 2</li><li>Item 3</li></ul>`;
                    break;
            }

            if(html) {
                // Wrapper for deletion
                let wrapper = doc.createElement('div');
                wrapper.className = 'editable-component';
                wrapper.innerHTML = html + `<button class="delete-btn" onclick="this.parentElement.remove()">√ó</button>`;
                container.appendChild(wrapper);
            }
        }

        function clearCanvas() {
            if(confirm("Clear everything?")) initCanvas();
        }

        // --- 3. PUBLISH LOGIC ---
        function openPublishModal() {
            document.getElementById('publishModal').style.display = 'flex';
        }

        async function publishToGitHub() {
            const fileName = document.getElementById('finalFileName').value.trim();
            const pageTitle = document.getElementById('finalPageTitle').value.trim();
            const headerTitle = document.getElementById('finalHeaderTitle').value.trim();
            
            if(!fileName || !pageTitle) { alert("Please fill details!"); return; }

            // Get generated content (remove delete buttons)
            let contentBody = doc.getElementById('content-area').innerHTML;
            // Clean up temporary edit classes
            contentBody = contentBody.replace(/class="editable-component"/g, '').replace(/<button class="delete-btn".*?<\/button>/g, '');

            // FINAL TEMPLATE (Combines with Master Layout)
            const finalHTML = `
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${pageTitle} - KASUMALGARH</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --royal-bg: #000033; --paper-bg: #fffbf0; --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); --maroon-text: #800000; --dark-gold-line: #aa8c2c; }
        body { margin: 0; background-color: var(--royal-bg); color: #333; font-family: 'Playfair Display', serif; overflow-x: hidden; }
        /* Common Styles */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: #000033; border-bottom: 2px solid #b38728; position: sticky; top: 0; z-index: 2000; }
        .navbar a { color: #897148; text-decoration: none; font-family: 'Cinzel', serif; font-weight: bold; margin-left: 15px; }
        .page-header { background: linear-gradient(rgba(0,0,51,0.7), rgba(0,0,51,0.9)), url('1.jpg'); background-size: cover; height: 300px; display: flex; justify-content: center; align-items: center; text-align: center; border-bottom: 4px solid #b38728; }
        .page-title { font-family: 'Cinzel', serif; font-size: 3em; color: #fcf6ba; text-transform: uppercase; text-shadow: 0 5px 10px rgba(0,0,0,0.8); }
        
        .main-content { padding: 40px 20px; min-height: 50vh; }
        .content-container { max-width: 900px; margin: 0 auto; background: var(--paper-bg); border: 2px solid #aa8c2c; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); text-align: center; }
        
        /* Your Custom Styles */
        .royal-heading { font-family: 'Cinzel', serif; color: var(--maroon-text); border-bottom: 2px solid var(--dark-gold-line); display: inline-block; margin-top: 20px; font-size:1.8em; }
        .royal-para { font-size: 1.1em; line-height: 1.6; color: #555; margin-bottom: 15px; text-align: left; }
        .gold-divider { text-align: center; font-size: 24px; color: #bf953f; margin: 20px 0; }
        .jharokha-box { border: 3px double var(--maroon-text); padding: 20px; margin: 20px 0; background: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.1); border-radius: 10px; }
        .royal-btn { display: inline-block; padding: 10px 25px; background: linear-gradient(to right, #000033, #000066); color: #fcf6ba; text-decoration: none; font-family: 'Cinzel', serif; font-weight: bold; border-radius: 50px; border: 1px solid var(--dark-gold-line); }
        img { max-width: 100%; border-radius: 5px; border: 2px solid var(--dark-gold-line); }
        
        footer { text-align: center; color: #b38728; padding: 20px; background-color: #000022; border-top: 4px solid #897148; }
        
        @media (max-width: 600px) { .page-title { font-size: 2em; } .navbar { flex-direction:column; gap:10px; } }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" style="font-size:1.5em; color:#fcf6ba;">KASUMALGARH</a>
        <div>
            <a href="index.html">HOME</a>
            <a href="vanshawali.html">VANSHAWALI</a>
            <a href="contact.html">CONTACT</a>
        </div>
    </nav>

    <header class="page-header">
        <h1 class="page-title">${headerTitle}</h1>
    </header>

    <main class="main-content">
        <div class="content-container">
            ${contentBody}
        </div>
    </main>

    <footer>&copy; 2025 Thikana Kasumalgarh</footer>
</body>
</html>`;

            // --- GITHUB UPLOAD ---
            const token = prompt("üîë Paste GitHub Secret Token:");
            if(!token) return;

            const GITHUB_USERNAME = "kasumalgarh";
            const REPO_NAME = "kasumalgarh.github.io";
            const BRANCH = "main"; // Or master

            try {
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${fileName}`;
                const putRes = await fetch(apiUrl, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: `Created ${fileName} via Visual Builder`,
                        content: btoa(unescape(encodeURIComponent(finalHTML))),
                        branch: BRANCH
                    })
                });

                if (putRes.ok) {
                    alert("üéâ Page Published Successfully!");
                    window.open(`https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/${fileName}`, '_blank');
                } else {
                    const err = await putRes.json();
                    alert("Error: " + err.message);
                }
            } catch (err) { alert("Network Error: " + err.message); }
        }
    </script>

</body>
</html>

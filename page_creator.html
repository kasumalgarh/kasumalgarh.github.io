<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>Master Website Builder - KASUMALGARH</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Playfair+Display&family=Lato&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ADMIN INTERFACE THEME --- */
        :root { --dark: #0f0f13; --panel: #1a1a2e; --gold: #d4af37; --text: #e0e0e0; }
        body { margin: 0; background: var(--dark); color: var(--text); font-family: 'Lato', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* TOP BAR */
        .navbar { height: 50px; background: #000; border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; flex-shrink: 0; }
        .brand { font-family: 'Cinzel'; color: var(--gold); font-weight: bold; font-size: 1.2em; }
        .top-btn { background: #333; color: #fff; border: 1px solid #555; padding: 6px 15px; cursor: pointer; border-radius: 4px; font-size: 0.9em; }
        .publish-btn { background: linear-gradient(45deg, #bf953f, #aa771c); color: #000; border: none; font-weight: bold; }

        /* LAYOUT */
        .workspace { display: flex; height: 100%; }
        
        /* SIDEBAR (SETTINGS) */
        .sidebar { width: 320px; background: var(--panel); border-right: 1px solid #333; overflow-y: auto; display: flex; flex-direction: column; }
        
        /* TABS IN SIDEBAR */
        .tabs { display: flex; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 12px; text-align: center; background: #151525; cursor: pointer; font-size: 0.9em; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom-color: var(--gold); color: #fff; background: var(--panel); }
        .tab:hover { background: #25253a; }

        .tab-content { padding: 20px; display: none; }
        .tab-content.active { display: block; }

        /* CONTROLS */
        .control-group { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .control-title { font-weight: bold; color: var(--gold); margin-bottom: 10px; display: flex; justify-content: space-between; font-family: 'Cinzel'; }
        
        label { display: block; color: #aaa; margin-bottom: 5px; font-size: 0.85em; }
        input[type="text"], input[type="color"], select, textarea { width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #fff; border-radius: 4px; box-sizing: border-box; margin-bottom: 10px; }
        input[type="checkbox"] { margin-right: 10px; }

        .add-btn { width: 100%; padding: 10px; background: #222; border: 1px dashed #555; color: #ccc; cursor: pointer; text-align: left; margin-bottom: 5px; transition: 0.2s; }
        .add-btn:hover { border-color: var(--gold); color: #fff; }
        .add-btn i { width: 20px; color: var(--gold); }

        /* PREVIEW AREA */
        .preview { flex: 1; background: #ccc; display: flex; justify-content: center; padding: 30px; overflow: hidden; }
        #liveFrame { width: 100%; max-width: 1200px; height: 100%; background: #fff; border: none; box-shadow: 0 0 30px rgba(0,0,0,0.5); }

        /* UPLOAD MODAL */
        #uploadModal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; }
        .modal-box { background: #222; padding: 30px; border: 2px solid var(--gold); width: 400px; text-align: center; border-radius: 10px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand"><i class="fas fa-tools"></i> WEBSITE BUILDER</div>
        <div style="display:flex; gap:10px;">
            <button onclick="openUploadModal()" class="top-btn"><i class="fas fa-upload"></i> UPLOAD FILES</button>
            <button onclick="publishPage()" class="top-btn publish-btn"><i class="fas fa-save"></i> SAVE & PUBLISH</button>
        </div>
    </nav>

    <div class="workspace">
        
        <div class="sidebar">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('settings')"><i class="fas fa-cog"></i> Settings</div>
                <div class="tab" onclick="switchTab('content')"><i class="fas fa-edit"></i> Content</div>
                <div class="tab" onclick="switchTab('style')"><i class="fas fa-paint-brush"></i> Style</div>
            </div>

            <div id="settings" class="tab-content active">
                <div class="control-group">
                    <div class="control-title">Basic Info</div>
                    <label>File Name (e.g. index2.html)</label>
                    <input type="text" id="fileName" placeholder="page.html">
                    <label>Browser Tab Title</label>
                    <input type="text" id="pageTitle" placeholder="My Page" oninput="updatePreview()">
                </div>

                <div class="control-group">
                    <div class="control-title">Layout Toggle</div>
                    <label><input type="checkbox" id="showNav" checked onchange="updatePreview()"> Show Navbar (Menu)</label>
                    <label><input type="checkbox" id="showHeader" checked onchange="updatePreview()"> Show Hero Header</label>
                    <label><input type="checkbox" id="showFooter" checked onchange="updatePreview()"> Show Footer</label>
                </div>

                <div class="control-group">
                    <div class="control-title">Menu Links</div>
                    <textarea id="menuLinks" rows="4" oninput="updatePreview()">HOME,index.html
VANSHAWALI,vanshawali.html
HISTORY,history.html
CONTACT,contact.html</textarea>
                    <small style="color:#666;">Format: Name,Link (New line per link)</small>
                </div>

                <div class="control-group">
                    <div class="control-title">Footer Info</div>
                    <label>Footer Title</label>
                    <input type="text" id="footerTitle" value="FORT KASUMBI" oninput="updatePreview()">
                    <label>Copyright Text</label>
                    <input type="text" id="footerCopy" value="¬© 2025 | All Rights Reserved." oninput="updatePreview()">
                </div>
            </div>

            <div id="content" class="tab-content">
                <div class="control-title">Add Elements</div>
                <button class="add-btn" onclick="addBlock('heading')"><i class="fas fa-heading"></i> Royal Heading</button>
                <button class="add-btn" onclick="addBlock('paragraph')"><i class="fas fa-paragraph"></i> Paragraph</button>
                <button class="add-btn" onclick="addBlock('image')"><i class="fas fa-image"></i> Image</button>
                <button class="add-btn" onclick="addBlock('jharokha')"><i class="fas fa-archway"></i> Jharokha Box</button>
                <button class="add-btn" onclick="addBlock('divider')"><i class="fas fa-grip-lines"></i> Gold Divider</button>
                <button class="add-btn" onclick="addBlock('gallery')"><i class="fas fa-th-large"></i> 3-Photo Grid</button>
                <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                    <button class="add-btn" onclick="clearContent()" style="color:#ff4444; border-color:#ff4444;"><i class="fas fa-trash"></i> Clear All Content</button>
                </div>
            </div>

            <div id="style" class="tab-content">
                <div class="control-group">
                    <div class="control-title">Colors</div>
                    <label>Background Color</label>
                    <input type="color" id="bgColor" value="#000033" oninput="updatePreview()">
                    <label>Paper/Card Color</label>
                    <input type="color" id="paperColor" value="#fffbf0" oninput="updatePreview()">
                    <label>Main Text Color</label>
                    <input type="color" id="textColor" value="#333333" oninput="updatePreview()">
                    <label>Royal Gold Color</label>
                    <input type="color" id="goldColor" value="#d4af37" oninput="updatePreview()">
                </div>
                <div class="control-group">
                    <div class="control-title">Fonts</div>
                    <label>Heading Font</label>
                    <select id="headFont" onchange="updatePreview()">
                        <option value="'Cinzel', serif">Cinzel (Royal)</option>
                        <option value="'Playfair Display', serif">Playfair Display</option>
                        <option value="Arial, sans-serif">Arial (Simple)</option>
                    </select>
                    <label>Body Font</label>
                    <select id="bodyFont" onchange="updatePreview()">
                        <option value="'Playfair Display', serif">Playfair Display</option>
                        <option value="'Lato', sans-serif">Lato (Clean)</option>
                        <option value="Georgia, serif">Georgia</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="preview">
            <iframe id="liveFrame"></iframe>
        </div>
    </div>

    <div id="uploadModal">
        <div class="modal-box">
            <h3 style="color:var(--gold); margin-top:0;">Direct File Upload</h3>
            <p style="color:#aaa; font-size:0.9em;">Upload images or files directly to your website repo.</p>
            
            <input type="file" id="fileInput" style="background:#333;" multiple>
            <input type="text" id="uploadPath" placeholder="Folder (e.g. images/ or blank for root)">
            
            <button onclick="uploadFiles()" class="top-btn publish-btn" style="width:100%; margin-top:10px;">START UPLOAD</button>
            <button onclick="document.getElementById('uploadModal').style.display='none'" style="background:none; border:none; color:#666; margin-top:10px; cursor:pointer;">Close</button>
            <div id="uploadStatus" style="margin-top:10px; font-weight:bold;"></div>
        </div>
    </div>

    <script>
        // --- 1. STATE & INIT ---
        let pageContent = []; // Stores HTML blocks
        const frame = document.getElementById('liveFrame');
        let doc;

        function init() {
            doc = frame.contentDocument || frame.contentWindow.document;
            updatePreview(); // Initial render
        }
        
        // Wait for iframe to load slightly
        setTimeout(init, 500);

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // --- 2. RENDER ENGINE (Generates the Website) ---
        function generateHTML() {
            // Get Settings
            const title = document.getElementById('pageTitle').value;
            const showNav = document.getElementById('showNav').checked;
            const showHeader = document.getElementById('showHeader').checked;
            const showFooter = document.getElementById('showFooter').checked;
            
            // Get Styles
            const bg = document.getElementById('bgColor').value;
            const paper = document.getElementById('paperColor').value;
            const text = document.getElementById('textColor').value;
            const gold = document.getElementById('goldColor').value;
            const hFont = document.getElementById('headFont').value;
            const bFont = document.getElementById('bodyFont').value;

            // Generate Menu Links
            const linksRaw = document.getElementById('menuLinks').value.trim().split('\n');
            let linksHTML = '';
            linksRaw.forEach(line => {
                let parts = line.split(',');
                if(parts.length === 2) linksHTML += `<li><a href="${parts[1].trim()}">${parts[0].trim()}</a></li>`;
            });

            // Generate Footer Data
            const fTitle = document.getElementById('footerTitle').value;
            const fCopy = document.getElementById('footerCopy').value;

            // Combine Content Blocks
            let bodyHTML = pageContent.join('\n');

            // --- THE TEMPLATE ---
            return `
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;1,400&family=Lato&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --royal-bg: ${bg}; 
            --paper-bg: ${paper}; 
            --text-color: ${text};
            --gold: ${gold}; 
            --maroon: #800000;
        }
        body { margin: 0; background-color: var(--royal-bg); color: var(--text-color); font-family: ${bFont}; overflow-x: hidden; }
        
        /* Navbar */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--royal-bg); border-bottom: 2px solid var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .navbar-brand { font-family: 'Cinzel', serif; font-size: 1.5em; font-weight: 900; color: #fcf6ba; text-decoration: none; }
        .navbar-links { list-style: none; padding:0; margin:0; display: flex; gap: 20px; }
        .navbar-links a { color: var(--gold); text-decoration: none; font-family: 'Cinzel', serif; font-weight: 700; transition:0.3s; }
        .navbar-links a:hover { color:#fff; }

        /* Header */
        .hero { background: linear-gradient(rgba(0,0,51,0.7), rgba(0,0,51,0.9)), url('1.jpg'); background-size: cover; height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border-bottom: 4px solid var(--gold); color: #fff; }
        .hero h1 { font-family: ${hFont}; font-size: 3em; margin: 0; color: #fcf6ba; text-shadow: 0 5px 10px rgba(0,0,0,0.8); }

        /* Content */
        .main-container { max-width: 1000px; margin: 40px auto; background: var(--paper-bg); padding: 40px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 2px solid var(--gold); min-height: 50vh; }
        
        /* Components */
        h1, h2, h3 { font-family: ${hFont}; color: var(--maroon); }
        .gold-divider { text-align: center; font-size: 24px; color: var(--gold); margin: 30px 0; }
        .jharokha { border: 3px double var(--maroon); padding: 20px; margin: 20px 0; background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 10px; text-align: center; }
        img { max-width: 100%; border-radius: 5px; border: 2px solid var(--gold); }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }

        /* Footer */
        footer { text-align: center; color: var(--gold); padding: 30px; background-color: #000022; border-top: 4px solid #897148; background-image: url('footerbg.png'); }
        .footer-title { font-family: 'Cinzel'; font-size: 1.5em; color: #fcf6ba; margin-bottom: 10px; }

        @media(max-width:600px) { .navbar { flex-direction:column; gap:10px; } .hero h1 { font-size:2em; } }
    </style>
</head>
<body>
    ${showNav ? `
    <nav class="navbar">
        <a class="navbar-brand" href="index.html">KASUMALGARH</a>
        <ul class="navbar-links">${linksHTML}</ul>
    </nav>` : ''}

    ${showHeader ? `
    <header class="hero">
        <h1>${title}</h1>
        <div style="font-size:30px; color:#bf953f; margin-top:10px;">‚öúÔ∏è ‚öúÔ∏è ‚öúÔ∏è</div>
    </header>` : ''}

    <main class="main-container">
        ${bodyHTML || '<p style="text-align:center; color:#888;"><i>(Content will appear here...)</i></p>'}
    </main>

    ${showFooter ? `
    <footer>
        <div class="footer-title">${fTitle}</div>
        <div>${fCopy}</div>
    </footer>` : ''}
</body>
</html>`;
        }

        function updatePreview() {
            doc.open();
            doc.write(generateHTML());
            doc.close();
        }

        // --- 3. CONTENT BLOCK LOGIC ---
        function addBlock(type) {
            let html = '';
            if(type === 'heading') {
                let txt = prompt("Heading Text:", "New Royal Heading");
                if(txt) html = `<h2 style="border-bottom:2px solid var(--gold); display:inline-block; padding-bottom:5px;">${txt}</h2>`;
            } else if(type === 'paragraph') {
                let txt = prompt("Text:", "Write your content here...");
                if(txt) html = `<p style="font-size:1.1em; line-height:1.6;">${txt}</p>`;
            } else if(type === 'divider') {
                html = `<div class="gold-divider">‚öúÔ∏è ‚öúÔ∏è ‚öúÔ∏è</div>`;
            } else if(type === 'jharokha') {
                let t = prompt("Box Title:", "Did You Know?");
                let c = prompt("Content:", "Details...");
                if(t) html = `<div class="jharokha"><h3>${t}</h3><p>${c}</p></div>`;
            } else if(type === 'image') {
                let url = prompt("Image URL:", "https://via.placeholder.com/800x400");
                if(url) html = `<div style="text-align:center;"><img src="${url}"></div>`;
            } else if(type === 'gallery') {
                html = `<div class="grid-3">
                    <img src="https://via.placeholder.com/300" alt="Img 1">
                    <img src="https://via.placeholder.com/300" alt="Img 2">
                    <img src="https://via.placeholder.com/300" alt="Img 3">
                </div>`;
            }

            if(html) {
                pageContent.push(html);
                updatePreview();
            }
        }

        function clearContent() {
            if(confirm("Delete all content blocks?")) {
                pageContent = [];
                updatePreview();
            }
        }

        // --- 4. FILE UPLOAD LOGIC ---
        function openUploadModal() { document.getElementById('uploadModal').style.display = 'flex'; }

        async function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            const pathPrefix = document.getElementById('uploadPath').value.trim();
            const status = document.getElementById('uploadStatus');
            const token = prompt("üîë Paste GitHub Token:");
            
            if(!token || files.length === 0) return alert("Token and Files required!");

            const USER = "kasumalgarh";
            const REPO = "kasumalgarh.github.io";
            
            status.innerHTML = "‚è≥ Uploading...";
            
            for (let i = 0; i < files.length; i++) {
                let file = files[i];
                let reader = new FileReader();
                
                reader.onload = async function(e) {
                    let content = e.target.result.split(',')[1]; // Base64
                    let filePath = pathPrefix ? `${pathPrefix}/${file.name}` : file.name;
                    
                    try {
                        await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${filePath}`, {
                            method: "PUT",
                            headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                            body: JSON.stringify({
                                message: `Uploaded ${file.name} via Builder`,
                                content: content,
                                branch: "main"
                            })
                        });
                        status.innerHTML += `<br>‚úÖ ${file.name} Uploaded!`;
                    } catch(err) {
                        status.innerHTML += `<br>‚ùå Error: ${file.name}`;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // --- 5. PUBLISH PAGE ---
        async function publishPage() {
            const fileName = document.getElementById('fileName').value;
            if(!fileName) return alert("Please enter a File Name in Settings!");
            
            const token = prompt("üîë Paste GitHub Token to Save Page:");
            if(!token) return;

            const finalCode = generateHTML();
            const USER = "kasumalgarh";
            const REPO = "kasumalgarh.github.io";

            // 1. Get SHA (if file exists to update)
            let sha = null;
            try {
                let res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${fileName}`);
                if(res.ok) { let data = await res.json(); sha = data.sha; }
            } catch(e) {}

            // 2. Upload
            try {
                let res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${fileName}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: `Builder: Updated ${fileName}`,
                        content: btoa(unescape(encodeURIComponent(finalCode))),
                        sha: sha,
                        branch: "main"
                    })
                });

                if(res.ok) {
                    alert("üéâ Page Saved & Published Successfully!");
                    window.open(`https://${USER}.github.io/${REPO}/${fileName}`, '_blank');
                } else {
                    alert("Error saving page.");
                }
            } catch(err) { alert("Network Error"); }
        }
    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>KASUMALGARH :: Super Admin Dashboard</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* (CSS ‡§µ‡§π‡•Ä ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§µ‡§æ‡§≤‡§æ ‡§π‡•à - ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡•á‡§µ‡§≤ Delete Section ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç) */
        body { background-color: #2c0001; color: #f4f4f4; font-family: 'Playfair Display', serif; text-align: center; padding: 0; margin: 0; opacity: 0; transition: opacity 0.5s; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #1a0000; border-bottom: 2px solid #d4af37; }
        .editor-section { border-top: 4px double #d4af37; margin-top: 40px; padding-top: 30px; background: rgba(0, 0, 0, 0.3); }
        .editor-wrapper { display: flex; gap: 20px; flex-wrap: wrap; text-align: left; }
        .editor-panel { flex: 1; min-width: 350px; background-color: rgba(0, 0, 0, 0.8); padding: 25px; border-radius: 10px; border: 2px solid #d4af37; }
        .preview-panel { flex: 1; min-width: 350px; background-color: #fdf5e6; color: #333; padding: 20px; border-radius: 10px; border: 2px solid #d4af37; max-height: 800px; overflow-y: auto; }
        
        input[type="text"], textarea { width: 100%; padding: 10px; margin-bottom: 15px; background-color: #222; color: #fff; border: 1px solid #d4af37; border-radius: 5px; box-sizing: border-box; }
        .tool-btn { background-color: #b38728; color: #000; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .delete-btn { background-color: #ff4444; color: white; border: 1px solid white; }
        .save-btn { background-color: #ff0000; color: white; margin-top: 10px; font-size: 1.2em; border: 2px solid white; animation: pulse 2s infinite; }

        /* PREVIEW TREE STYLE */
        .tree ul { list-style: none; padding-left: 20px; margin: 0; border-left: 2px solid #800000; }
        .tree li { padding: 5px 0; position: relative; }
        .member-card { border: 2px solid #b38728; padding: 5px 10px; background: #fffbf0; color: #800000; font-weight: bold; display: inline-block; border-radius: 5px; }
    </style>

    <script>
        // CONFIG
        const GITHUB_USERNAME = "kasumalgarh";       
        const REPO_NAME = "kasumalgarh.github.io";   
        const FILE_PATH = "vanshawali.html";         
        const BRANCH = "main";                       

        function checkPassword() {
            const CORRECT_PASSWORD = "kasumalgarh2025"; 
            let passwordAttempt = prompt("Admin Panel Access Password:");
            if (passwordAttempt === CORRECT_PASSWORD) { document.body.classList.add('visible'); } 
            else { alert("Wrong Password!"); window.location.href = "index.html"; }
        }

        // 1. FETCH LIVE CODE
        async function fetchLiveCode() {
            const btn = document.querySelector('button[onclick="fetchLiveCode()"]');
            btn.innerHTML = "‚è≥ Loading...";
            try {
                const response = await fetch(FILE_PATH + '?v=' + new Date().getTime());
                if (!response.ok) throw new Error("File not found");
                const text = await response.text();
                document.getElementById('inputHtml').value = text;
                document.getElementById('outputHtml').value = text; 
                loadPreview();
                alert("‚úÖ ‡§ï‡•ã‡§° ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ!");
            } catch (err) { alert("Error: " + err.message); } 
            finally { btn.innerHTML = "üåê Load Live Code (Auto)"; }
        }

        // 2. LOAD PREVIEW
        function loadPreview() {
            const code = document.getElementById('inputHtml').value;
            if(code) document.getElementById('livePreview').innerHTML = code;
        }

        // 3. ADD NAME (Logic Unchanged)
        function addName() {
            const htmlContent = document.getElementById('inputHtml').value;
            const parent = document.getElementById('parentName').value.trim();
            const child = document.getElementById('newName').value.trim();

            if (!htmlContent || !parent || !child) { alert("‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç!"); return; }

            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const allSpans = doc.querySelectorAll('.member-name');
            let parentFound = false;

            for (let span of allSpans) {
                if (span.textContent.trim() === parent) {
                    const parentLi = span.closest('li'); 
                    let childUl = parentLi.querySelector('ul');
                    if (!childUl) {
                        childUl = doc.createElement('ul');
                        parentLi.appendChild(childUl);
                    }
                    const newLi = doc.createElement('li');
                    newLi.innerHTML = `<div class="member-card"><span class="member-name">${child}</span></div>`;
                    childUl.appendChild(newLi);
                    parentFound = true;
                    break; 
                }
            }
            if (parentFound) {
                updateAndPreview(doc);
                alert("‚úÖ ‡§®‡§æ‡§Æ ‡§ú‡•Å‡§°‡§º ‡§ó‡§Ø‡§æ! ‡§Ö‡§¨ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§");
            } else { alert("‚ùå ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§"); }
        }

        // 4. üî• DELETE NAME FUNCTION (UPDATED)
        function deleteName() {
            const nameToDelete = document.getElementById('deleteNameInput').value.trim();
            const parentOfDelete = document.getElementById('parentOfDeleteInput').value.trim(); // NEW INPUT
            const htmlContent = document.getElementById('inputHtml').value;

            if (!nameToDelete || !parentOfDelete || !htmlContent) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•ã‡§° ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§"); return; }

            if(!confirm(`‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ${parentOfDelete} ‡§ï‡•á ‡§¨‡•á‡§ü‡•á "${nameToDelete}" ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`)) return;

            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const allSpans = doc.querySelectorAll('.member-name');
            let deleted = false;

            for (let span of allSpans) {
                // 1. Find the name to delete
                if (span.textContent.trim() === nameToDelete) {
                    const liToDelete = span.closest('li'); 
                    const parentUl = liToDelete ? liToDelete.parentElement : null;

                    if (parentUl) {
                        // 2. Find the Grandparent/Father (the name you want to match the parent against)
                        const grandParentLi = parentUl.closest('li');
                        const grandParentSpan = grandParentLi ? grandParentLi.querySelector('.member-name') : null;

                        // 3. Check if the parent of the deleted name matches the input
                        if (grandParentSpan && grandParentSpan.textContent.trim() === parentOfDelete) {
                            liToDelete.remove(); // üî• Delete the element
                            deleted = true;
                            break; 
                        }
                    }
                }
            }

            if (deleted) {
                updateAndPreview(doc);
                alert(`üóëÔ∏è ${parentOfDelete} ‡§ï‡•á ‡§¨‡•á‡§ü‡•á "${nameToDelete}" ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§`);
                document.getElementById('deleteNameInput').value = ""; // Clear input
                document.getElementById('parentOfDeleteInput').value = ""; // Clear parent input
            } else {
                alert(`‚ùå "${nameToDelete}" ‡§®‡§æ‡§Æ ${parentOfDelete} ‡§ï‡•á ‡§¨‡•á‡§ü‡•á ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§µ‡§∞‡•ç‡§§‡§®‡•Ä (Spelling) ‡§Ø‡§æ ‡§™‡•Ä‡•ù‡•Ä (Generation) ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§`);
            }
        }


        // Helper Function to Update Textareas & Preview
        function updateAndPreview(doc) {
            const updatedHTML = doc.documentElement.outerHTML;
            document.getElementById('outputHtml').value = updatedHTML;
            document.getElementById('livePreview').innerHTML = updatedHTML;
            document.getElementById('inputHtml').value = updatedHTML; 
        }

        // 5. SAVE TO GITHUB
        async function saveToGitHub() {
            const token = prompt("GitHub Secret Key (Token):");
            if (!token) { alert("Token ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à!"); return; }

            const content = document.getElementById('outputHtml').value;
            if (!content) { alert("‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡•ã‡§° ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á!"); return; }

            const btn = document.querySelector('.save-btn');
            btn.innerHTML = "‚è≥ Saving...";

            try {
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
                const getRes = await fetch(apiUrl, { headers: { "Authorization": `token ${token}` } });
                const getData = await getRes.json();
                
                const putRes = await fetch(apiUrl, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Vanshawali entry deleted via Admin Panel",
                        content: btoa(unescape(encodeURIComponent(content))),
                        sha: getData.sha,
                        branch: BRANCH
                    })
                });

                if (putRes.ok) alert("üéâ ‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§");
                else { const err = await putRes.json(); alert("Error: " + err.message); }

            } catch (err) { alert("Network Error"); } 
            finally { btn.innerHTML = "üíæ SAVE TO WEBSITE (LIVE)"; }
        }
    </script>

</body>
</html>

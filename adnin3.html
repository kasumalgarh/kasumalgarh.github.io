<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>KASUMALGARH :: Super Admin Dashboard</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* (CSS ‡§µ‡§π‡•Ä ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§µ‡§æ‡§≤‡§æ ‡§π‡•à - ‡§ú‡§ó‡§π ‡§¨‡§ö‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§õ‡•ã‡§ü‡§æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å) */
        body { background-color: #2c0001; color: #f4f4f4; font-family: 'Playfair Display', serif; text-align: center; padding: 0; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #1a0000; border-bottom: 2px solid #d4af37; }
        .action-btn { display: block; background: #008000; color: white; padding: 10px; border-radius: 5px; font-weight: bold; text-decoration: none; }
        
        /* EDITOR STYLES */
        .editor-section { border-top: 4px double #d4af37; margin-top: 40px; padding-top: 30px; background: rgba(0, 0, 0, 0.3); }
        .editor-wrapper { display: flex; gap: 20px; flex-wrap: wrap; text-align: left; }
        .editor-panel { flex: 1; min-width: 350px; background-color: rgba(0, 0, 0, 0.8); padding: 25px; border-radius: 10px; border: 2px solid #d4af37; }
        .preview-panel { flex: 1; min-width: 350px; background-color: #fdf5e6; color: #333; padding: 20px; border-radius: 10px; border: 2px solid #d4af37; max-height: 800px; overflow-y: auto; }
        
        input[type="text"], textarea { width: 100%; padding: 10px; margin-bottom: 15px; background-color: #222; color: #fff; border: 1px solid #d4af37; border-radius: 5px; box-sizing: border-box; }
        textarea { min-height: 120px; font-family: monospace; font-size: 0.9em; }
        .tool-btn { background-color: #b38728; color: #000; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .tool-btn:hover { background-color: #ffd700; }
        
        /* ‚ú® SAVE BUTTON STYLE */
        .save-btn { background-color: #ff0000; color: white; margin-top: 10px; font-size: 1.2em; border: 2px solid white; animation: pulse 2s infinite; }
        .save-btn:hover { background-color: #cc0000; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } }

        /* Preview Tree Style */
        .tree ul { list-style: none; padding-left: 20px; margin: 0; border-left: 2px solid #800000; }
        .tree li { padding: 5px 0; position: relative; }
        .member-card { border: 2px solid #b38728; padding: 5px 10px; background: #fffbf0; color: #800000; font-weight: bold; display: inline-block; border-radius: 5px; }
    </style>
</head>

<body>

    <nav class="navbar">
        <div style="font-family:'Cinzel'; font-size:1.5em; font-weight:bold; color:#fcf6ba;">KASUMALGARH ADMIN</div>
        <a href="index.html" style="color:#ff4444; font-weight:bold; text-decoration:none;">Logout</a>
    </nav>

    <div class="container">
        
        <div class="editor-section" id="editor-tool">
            <h2 style="color:#d4af37;">üìù Vanshavali Editor (Direct Save Mode)</h2>
            <p style="color:#ccc; margin-bottom: 20px;">‡§®‡§æ‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ 'Save to Website' ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§ 1 ‡§Æ‡§ø‡§®‡§ü ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</p>

            <div class="editor-wrapper">
                
                <div class="editor-panel">
                    <h3>1. ‡§ï‡•ã‡§° ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</h3>
                    <button onclick="fetchLiveCode()" class="tool-btn" style="background:#008080; color:#fff;">üåê Load Live Code</button>
                    <textarea id="inputHtml" placeholder="‡§ï‡•ã‡§° ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§è‡§ó‡§æ..."></textarea>

                    <hr style="border-color:#555; margin: 20px 0;">

                    <h3>2. ‡§®‡§æ‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                    <input type="text" id="grandParentName" placeholder="‡§¶‡§æ‡§¶‡§æ (Grandparent): Th. Ridmal Singh">
                    <input type="text" id="parentName" placeholder="‡§™‡§ø‡§§‡§æ (Father): Th. Bhairu Singh">
                    <input type="text" id="newName" placeholder="‡§®‡§Ø‡§æ ‡§®‡§æ‡§Æ (Child): Kr. Yuvraj Singh">
                    <button onclick="addName()" class="tool-btn" style="background:#d4af37; color:#000;">‚ûï ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>

                    <hr style="border-color:#555; margin: 20px 0;">

                    <h3>3. ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</h3>
                    <textarea id="outputHtml" readonly placeholder="‡§®‡§Ø‡§æ ‡§ï‡•ã‡§° ‡§Ø‡§π‡§æ‡§Å ‡§¨‡§®‡•á‡§ó‡§æ..."></textarea>
                    
                    <button onclick="saveToGitHub()" class="tool-btn save-btn">
                        üíæ SAVE TO WEBSITE (LIVE)
                    </button>
                </div>

                <div class="preview-panel">
                    <h3 style="color:#800000; border-bottom:1px solid #800000;">Live Preview</h3>
                    <div id="livePreview" class="tree">
                        <p style="color:#666; font-style:italic; padding:20px;">'Load Live Code' ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç...</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // ‚ö†Ô∏è CONFIGURATION - ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡§π‡§æ‡§Å ‡§≠‡§∞‡•á‡§Ç
        // ---------------------------------------------------------
        const GITHUB_USERNAME = "kasumalgarh";       // ‡§Ü‡§™‡§ï‡•Ä GitHub ID
        const REPO_NAME = "kasumalgarh.github.io";   // ‡§Ü‡§™‡§ï‡•á Repo ‡§ï‡§æ ‡§®‡§æ‡§Æ
        const FILE_PATH = "vanshawali.html";         // ‡§ú‡§ø‡§∏ ‡§´‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡§æ ‡§π‡•à
        const BRANCH = "main";                       // ‡§¨‡•ç‡§∞‡§æ‡§Ç‡§ö (main ‡§Ø‡§æ master)
        // ---------------------------------------------------------

        // 1. FETCH LIVE CODE
        async function fetchLiveCode() {
            const btn = document.querySelector('button[onclick="fetchLiveCode()"]');
            btn.innerHTML = "‚è≥ Loading...";
            try {
                const response = await fetch(FILE_PATH + '?v=' + new Date().getTime());
                if (!response.ok) throw new Error("File not found");
                const text = await response.text();
                document.getElementById('inputHtml').value = text;
                loadPreview();
                alert("‚úÖ ‡§ï‡•ã‡§° ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ!");
            } catch (err) { alert("Error: " + err.message); } 
            finally { btn.innerHTML = "üåê Load Live Code"; }
        }

        // 2. LOAD PREVIEW
        function loadPreview() {
            const code = document.getElementById('inputHtml').value;
            if(code) document.getElementById('livePreview').innerHTML = code;
        }

        // 3. ADD NAME LOGIC
        function addName() {
            const htmlContent = document.getElementById('inputHtml').value;
            const grandParent = document.getElementById('grandParentName').value.trim();
            const parent = document.getElementById('parentName').value.trim();
            const child = document.getElementById('newName').value.trim();

            if (!htmlContent || !grandParent || !parent || !child) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç!"); return; }

            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const allSpans = doc.querySelectorAll('.member-name');
            let parentFound = false;

            for (let span of allSpans) {
                if (span.textContent.trim() === parent) {
                    const parentLi = span.closest('li'); 
                    let childUl = parentLi.querySelector('ul');
                    if (!childUl) {
                        childUl = doc.createElement('ul');
                        parentLi.appendChild(childUl);
                    }
                    const newLi = doc.createElement('li');
                    newLi.innerHTML = `<div class="member-card"><span class="member-name">${child}</span></div>`;
                    childUl.appendChild(newLi);
                    parentFound = true;
                    break; 
                }
            }

            if (parentFound) {
                const updatedHTML = doc.documentElement.outerHTML; 
                document.getElementById('outputHtml').value = updatedHTML;
                document.getElementById('livePreview').innerHTML = updatedHTML;
                document.getElementById('inputHtml').value = updatedHTML; 
                alert("‚úÖ ‡§®‡§æ‡§Æ ‡§ú‡•Å‡§°‡§º ‡§ó‡§Ø‡§æ! ‡§Ö‡§¨ ‡§®‡•Ä‡§ö‡•á ‡§≤‡§æ‡§≤ ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§");
            } else {
                alert("‚ùå ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§");
            }
        }

        // 4. üî• SAVE TO GITHUB (THE MAGIC FUNCTION)
        async function saveToGitHub() {
            // ‡§∏‡§ø‡§ï‡•ç‡§Ø‡•ã‡§∞‡§ø‡§ü‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•ã‡§ï‡§® ‡§π‡§∞ ‡§¨‡§æ‡§∞ ‡§™‡•Ç‡§õ‡•á‡§Ç‡§ó‡•á (‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á)
            const token = prompt("‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä GitHub Secret Key (Token) ‡§°‡§æ‡§≤‡•á‡§Ç:");
            
            if (!token) { alert("Token ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à!"); return; }

            const content = document.getElementById('outputHtml').value;
            if (!content) { alert("‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!"); return; }

            const btn = document.querySelector('.save-btn');
            btn.innerHTML = "‚è≥ Saving...";

            try {
                // Step A: Get current file SHA (GitHub ‡§ï‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§)
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
                
                const getRes = await fetch(apiUrl, {
                    headers: { "Authorization": `token ${token}` }
                });
                
                const getData = await getRes.json();
                const currentSha = getData.sha;

                // Step B: Update File (PUT Request)
                // GitHub ‡§ï‡•ã Base64 ‡§è‡§®‡§ï‡•ã‡§°‡•á‡§° ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§ö‡§æ‡§π‡§ø‡§è ‡§π‡•ã‡§§‡§æ ‡§π‡•à (UTF-8 ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•á ‡§∏‡§æ‡§•)
                const base64Content = btoa(unescape(encodeURIComponent(content)));

                const putBody = {
                    message: "Vanshawali Updated via Admin Panel",
                    content: base64Content,
                    sha: currentSha,
                    branch: BRANCH
                };

                const putRes = await fetch(apiUrl, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(putBody)
                });

                if (putRes.ok) {
                    alert("üéâ ‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§ (‡§¨‡§¶‡§≤‡§æ‡§µ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§Æ‡•á‡§Ç 1-2 ‡§Æ‡§ø‡§®‡§ü ‡§≤‡§ó ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)");
                } else {
                    const err = await putRes.json();
                    alert("‚ùå ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü! Error: " + err.message);
                }

            } catch (err) {
                alert("‚ùå ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§è‡§∞‡§∞: " + err.message);
            } finally {
                btn.innerHTML = "üíæ SAVE TO WEBSITE (LIVE)";
            }
        }
    </script>

</body>
</html>
